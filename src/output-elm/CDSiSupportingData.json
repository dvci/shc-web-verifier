{"library":{"annotation":[{"translatorOptions":"","type":"CqlToElmInfo"}],"identifier":{"id":"CDSiSupportingData","version":"1"},"schemaIdentifier":{"id":"urn:hl7-org:elm","version":"r1"},"usings":{"def":[{"localIdentifier":"System","uri":"urn:hl7-org:elm-types:r1"},{"localIdentifier":"FHIR","uri":"http://hl7.org/fhir","version":"4.0.0"}]},"includes":{"def":[{"localIdentifier":"FHIRHelpers","path":"FHIRHelpers","version":"4.0.0"}]},"parameters":{"def":[{"name":"SeriesDefinition","accessLevel":"Public","parameterTypeSpecifier":{"name":"{http://hl7.org/fhir}Parameters","type":"NamedTypeSpecifier"}}]},"contexts":{"def":[{"name":"Patient"}]},"statements":{"def":[{"name":"Patient","context":"Patient","expression":{"type":"SingletonFrom","operand":{"dataType":"{http://hl7.org/fhir}Patient","type":"Retrieve"}}},{"name":"Immunizations","context":"Patient","accessLevel":"Public","expression":{"type":"Query","source":[{"alias":"immunization","expression":{"dataType":"{http://hl7.org/fhir}Immunization","type":"Retrieve"}}],"relationship":[],"sort":{"by":[{"direction":"asc","type":"ByExpression","expression":{"strict":false,"type":"As","operand":{"name":"occurrence","type":"IdentifierRef"},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}}]}}},{"name":"ValidAllowableVaccine","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Exists","operand":{"type":"Query","source":[{"alias":"coding","expression":{"path":"coding","type":"Property","source":{"path":"vaccineCode","type":"Property","source":{"name":"immunization","type":"OperandRef"}}}}],"relationship":[],"where":{"type":"And","operand":[{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"system","scope":"coding","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"http://hl7.org/fhir/sid/cvx","type":"Literal"}]},{"type":"In","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"asType":"{http://hl7.org/fhir}code","type":"As","operand":{"path":"code","scope":"coding","type":"Property"}}]},{"type":"Query","source":[{"alias":"$this","expression":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableVaccine","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"cvx","type":"Literal"}]}}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"value","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"value","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}]}]}}},"operand":[{"name":"allowableVaccine","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"ValidAllowableInterval","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"Equal","operand":[{"type":"Count","source":{"name":"allowableInterval","type":"OperandRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinInt","type":"Literal"}]}}}}}}}]},"then":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"},"else":{"type":"And","operand":[{"type":"And","operand":[{"type":"Equal","operand":[{"asType":"{urn:hl7-org:elm-types:r1}String","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"fromPrevious","type":"Literal"}]}}}}}},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]},{"type":"Not","operand":{"type":"IsNull","operand":{"name":"previousImmunization","type":"OperandRef"}}}]},{"type":"Case","comparand":{"path":"value","type":"Property","source":{"path":"unit","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinInt","type":"Literal"}]}}}}}},"caseItem":[{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"d","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Day","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinInt","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"mo","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Month","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinInt","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"a","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Year","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinInt","type":"Literal"}]}}}}}}}]}}],"else":{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"type":"Null"}}}]}},"operand":[{"name":"allowableInterval","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"previousImmunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"ValidAllowableAge","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"Equal","operand":[{"type":"Count","source":{"name":"age","type":"OperandRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinAge","type":"Literal"}]}}}}}}}]},"then":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"},"else":{"type":"Case","comparand":{"path":"value","type":"Property","source":{"path":"unit","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinAge","type":"Literal"}]}}}}}},"caseItem":[{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"d","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Day","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinAge","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"mo","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Month","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinAge","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"a","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Year","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"absMinAge","type":"Literal"}]}}}}}}}]}}],"else":{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"type":"Null"}}}},"operand":[{"name":"age","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"ValidSeriesDose","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"And","operand":[{"type":"And","operand":[{"name":"ValidAllowableVaccine","type":"FunctionRef","operand":[{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"seriesDose","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"allowableVaccine","type":"Literal"}]}},{"name":"immunization","type":"OperandRef"}]},{"name":"ValidAllowableInterval","type":"FunctionRef","operand":[{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"seriesDose","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"allowableInterval","type":"Literal"}]}},{"name":"immunization","type":"OperandRef"},{"name":"previousImmunization","type":"OperandRef"}]}]},{"name":"ValidAllowableAge","type":"FunctionRef","operand":[{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"seriesDose","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"age","type":"Literal"}]}},{"name":"immunization","type":"OperandRef"}]}]},"operand":[{"name":"seriesDose","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"previousImmunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"ValidEarliestRecAge","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"Equal","operand":[{"type":"Count","source":{"name":"age","type":"OperandRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"earliestRecAge","type":"Literal"}]}}}}}}}]},"then":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"},"else":{"type":"Case","comparand":{"path":"value","type":"Property","source":{"path":"unit","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"earliestRecAge","type":"Literal"}]}}}}}},"caseItem":[{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"d","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Day","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"earliestRecAge","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"mo","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Month","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"earliestRecAge","type":"Literal"}]}}}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"a","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Year","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"asType":"{urn:hl7-org:elm-types:r1}Decimal","type":"As","operand":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"age","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"earliestRecAge","type":"Literal"}]}}}}}}}]}}],"else":{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"type":"Null"}}}},"operand":[{"name":"age","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"RecommendedSeriesDose","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"name":"ValidEarliestRecAge","type":"FunctionRef","operand":[{"type":"Query","source":[{"alias":"$this","expression":{"type":"Flatten","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"seriesDose","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"part","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"age","type":"Literal"}]}},{"name":"immunization","type":"OperandRef"}]},"operand":[{"name":"seriesDose","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"previousImmunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"EvaluateImmunizations","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Query","source":[{"alias":"immunization","expression":{"type":"Slice","source":{"name":"Immunizations","type":"ExpressionRef"},"startIndex":{"name":"startingImmunizationIndex","type":"OperandRef"},"endIndex":{"resultTypeName":"{urn:hl7-org:elm-types:r1}Integer","type":"Null"}}}],"relationship":[],"aggregate":{"identifier":"R","distinct":false,"expression":{"type":"Union","operand":[{"type":"As","operand":{"name":"R","type":"QueryLetRef"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"recommendedDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]}]}}},{"type":"As","operand":{"type":"List","element":[{"type":"Query","source":[{"alias":"X","expression":{"name":"immunization","type":"AliasRef"}}],"let":[{"identifier":"currentImmunizationIndex","expression":{"type":"If","condition":{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},"then":{"type":"Add","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"name":"startingImmunizationIndex","type":"OperandRef"}]},"else":{"name":"startingImmunizationIndex","type":"OperandRef"}}},{"identifier":"previousValidImmunizationIndex","expression":{"type":"If","condition":{"type":"And","operand":[{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"Exists","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}]},"then":{"path":"immunizationIndex","type":"Property","source":{"type":"Last","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}},"else":{"type":"Negate","operand":{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"1","type":"Literal"}}}},{"identifier":"currentDoseIndex","expression":{"type":"If","condition":{"type":"And","operand":[{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"Exists","operand":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}]},"then":{"type":"Add","operand":[{"path":"doseIndex","type":"Property","source":{"type":"Last","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"1","type":"Literal"}]},"else":{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}}}],"relationship":[],"return":{"expression":{"type":"If","condition":{"type":"GreaterOrEqual","operand":[{"name":"currentDoseIndex","type":"QueryLetRef"},{"type":"Count","source":{"name":"seriesDoses","type":"OperandRef"}}]},"then":{"type":"Tuple","element":[{"name":"doseNumber","value":{"type":"Null"}},{"name":"doseIndex","value":{"type":"Null"}},{"name":"immunizationIndex","value":{"name":"currentImmunizationIndex","type":"QueryLetRef"}},{"name":"immunization","value":{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]}},{"name":"validDose","value":{"type":"Null"}},{"name":"recommendedDose","value":{"type":"Null"}}]},"else":{"type":"Tuple","element":[{"name":"doseNumber","value":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"path":"part","type":"Property","source":{"type":"Indexer","operand":[{"name":"seriesDoses","type":"OperandRef"},{"name":"currentDoseIndex","type":"QueryLetRef"}]}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"doseNumber","type":"Literal"}]}}}}}},{"name":"doseIndex","value":{"name":"currentDoseIndex","type":"QueryLetRef"}},{"name":"immunizationIndex","value":{"name":"currentImmunizationIndex","type":"QueryLetRef"}},{"name":"immunization","value":{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]}},{"name":"validDose","value":{"name":"ValidSeriesDose","type":"FunctionRef","operand":[{"type":"ToList","operand":{"type":"Indexer","operand":[{"name":"seriesDoses","type":"OperandRef"},{"name":"currentDoseIndex","type":"QueryLetRef"}]}},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"previousValidImmunizationIndex","type":"QueryLetRef"}]}]}},{"name":"recommendedDose","value":{"name":"RecommendedSeriesDose","type":"FunctionRef","operand":[{"type":"ToList","operand":{"type":"Indexer","operand":[{"name":"seriesDoses","type":"OperandRef"},{"name":"currentDoseIndex","type":"QueryLetRef"}]}},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"previousValidImmunizationIndex","type":"QueryLetRef"}]}]}}]}}}}]},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"recommendedDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]}]}}}]},"starting":{"strict":false,"type":"As","operand":{"type":"List"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}}},"operand":[{"name":"seriesDoses","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}},{"name":"startingImmunizationIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}}]},{"name":"EvaluateSeriesDoses","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Query","source":[{"alias":"immunization","expression":{"name":"Immunizations","type":"ExpressionRef"}}],"relationship":[],"aggregate":{"identifier":"R","distinct":false,"expression":{"type":"Union","operand":[{"type":"As","operand":{"name":"R","type":"QueryLetRef"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}},{"name":"doses","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}},{"type":"As","operand":{"type":"List","element":[{"type":"Query","source":[{"alias":"X","expression":{"name":"immunization","type":"AliasRef"}}],"let":[{"identifier":"currentImmunizationIndex","expression":{"type":"Count","source":{"name":"R","type":"QueryLetRef"}}},{"identifier":"eval","expression":{"name":"EvaluateImmunizations","type":"FunctionRef","operand":[{"name":"seriesDoses","type":"OperandRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]}}],"relationship":[],"return":{"expression":{"type":"If","condition":{"type":"Equal","operand":[{"type":"Count","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"eval","type":"QueryLetRef"}}],"where":{"type":"Or","operand":[{"type":"Equal","operand":[{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"path":"validDose","scope":"$this","type":"Property"}},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]},{"type":"Equal","operand":[{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"path":"recommendedDose","scope":"$this","type":"Property"}},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"false","type":"Literal"}]}]}}},{"type":"Count","source":{"name":"seriesDoses","type":"OperandRef"}}]},"then":{"type":"Tuple","element":[{"name":"startingImmunizationIndex","value":{"name":"currentImmunizationIndex","type":"QueryLetRef"}},{"name":"validSeries","value":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}},{"name":"doses","value":{"type":"Query","source":[{"alias":"$this","expression":{"name":"eval","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"path":"validDose","scope":"$this","type":"Property"}},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}]},"else":{"type":"Tuple","element":[{"name":"startingImmunizationIndex","value":{"name":"currentImmunizationIndex","type":"QueryLetRef"}},{"name":"validSeries","value":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"false","type":"Literal"}},{"name":"doses","value":{"type":"Null"}}]}}}}]},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}},{"name":"doses","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}}]},"starting":{"strict":false,"type":"As","operand":{"type":"List"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}}},"operand":[{"name":"seriesDoses","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"name":"{http://hl7.org/fhir}Parameters.Parameter","type":"NamedTypeSpecifier"}}}]},{"name":"EvaluateSeries","context":"Patient","accessLevel":"Public","expression":{"type":"Query","source":[{"alias":"series","expression":{"type":"Query","source":[{"alias":"$this","expression":{"path":"parameter","type":"Property","source":{"name":"SeriesDefinition","type":"ParameterRef"}}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"series","type":"Literal"}]}}}],"relationship":[],"return":{"expression":{"type":"Tuple","element":[{"name":"seriesName","value":{"path":"value","type":"Property","source":{"path":"value","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"path":"part","scope":"series","type":"Property"}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"seriesName","type":"Literal"}]}}}}}},{"name":"complete","value":{"type":"Query","source":[{"alias":"$this","expression":{"type":"Query","source":[{"alias":"$this","expression":{"name":"EvaluateSeriesDoses","type":"FunctionRef","operand":[{"type":"Query","source":[{"alias":"$this","expression":{"path":"part","scope":"series","type":"Property"}}],"where":{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"name","scope":"$this","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"seriesDose","type":"Literal"}]}}]}}],"where":{"type":"Equal","operand":[{"path":"validSeries","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"doses","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"doses","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}}]}}}},{"name":"Run","context":"Patient","accessLevel":"Public","expression":{"name":"EvaluateSeries","type":"ExpressionRef"}}]}}}