{"library":{"annotation":[{"translatorOptions":"","type":"CqlToElmInfo"}],"identifier":{"id":"CDSiSupportingData","version":"1"},"schemaIdentifier":{"id":"urn:hl7-org:elm","version":"r1"},"usings":{"def":[{"localIdentifier":"System","uri":"urn:hl7-org:elm-types:r1"},{"localIdentifier":"FHIR","uri":"http://hl7.org/fhir","version":"4.0.0"}]},"includes":{"def":[{"localIdentifier":"FHIRHelpers","path":"FHIRHelpers","version":"4.0.0"}]},"parameters":{"def":[{"name":"AntigenSupportingData","accessLevel":"Public","parameterTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"series","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"seriesName","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"seriesType","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"seriesDose","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}}]}}}]}},{"name":"AntigenAncillaryData","accessLevel":"Public","parameterTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"series","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"seriesName","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"primarySeriesNumberDoses","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}}]}}}]}}]},"contexts":{"def":[{"name":"Patient"}]},"statements":{"def":[{"name":"Patient","context":"Patient","expression":{"type":"SingletonFrom","operand":{"dataType":"{http://hl7.org/fhir}Patient","type":"Retrieve"}}},{"name":"Immunizations","context":"Patient","accessLevel":"Public","expression":{"type":"Query","source":[{"alias":"immunization","expression":{"dataType":"{http://hl7.org/fhir}Immunization","type":"Retrieve"}}],"relationship":[],"sort":{"by":[{"direction":"asc","type":"ByExpression","expression":{"strict":false,"type":"As","operand":{"name":"occurrence","type":"IdentifierRef"},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}}]}}},{"name":"IsValidAllowableVaccine","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Exists","operand":{"type":"Query","source":[{"alias":"coding","expression":{"path":"coding","type":"Property","source":{"path":"vaccineCode","type":"Property","source":{"name":"immunization","type":"OperandRef"}}}}],"relationship":[],"where":{"type":"And","operand":[{"type":"Equal","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"system","scope":"coding","type":"Property"}]},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"http://hl7.org/fhir/sid/cvx","type":"Literal"}]},{"type":"In","operand":[{"name":"ToString","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"path":"code","scope":"coding","type":"Property"}]},{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableVaccine","type":"OperandRef"}}],"where":{"type":"Not","operand":{"type":"IsNull","operand":{"path":"cvx","type":"Property","source":{"name":"$this","type":"AliasRef"}}}},"return":{"distinct":false,"expression":{"path":"cvx","type":"Property","source":{"name":"$this","type":"AliasRef"}}}}]}]}}},"operand":[{"name":"allowableVaccine","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"IsValidAllowableInterval","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"Or","operand":[{"type":"Or","operand":[{"type":"Equal","operand":[{"type":"Count","source":{"name":"allowableInterval","type":"OperandRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"Equal","operand":[{"type":"Count","source":{"type":"ToList","operand":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]}]},{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}}}]},{"type":"IsNull","operand":{"name":"previousImmunization","type":"OperandRef"}}]},"then":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"},"else":{"type":"Case","comparand":{"path":"unit","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}},"caseItem":[{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"d","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Day","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"wk","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Week","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"mo","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Month","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"a","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Year","type":"DifferenceBetween","operand":[{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"previousImmunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinInt","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"allowableInterval","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"fromPrevious","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Y","type":"Literal"}]}}}}}]}}],"else":{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"type":"Null"}}}},"operand":[{"name":"allowableInterval","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"previousImmunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"IsValidAllowableAge","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"Equal","operand":[{"type":"Count","source":{"type":"ToList","operand":{"name":"age","type":"OperandRef"}}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},{"type":"IsNull","operand":{"path":"value","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}}}]},"then":{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"},"else":{"type":"Case","comparand":{"path":"unit","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}},"caseItem":[{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"d","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Day","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"wk","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Week","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"mo","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Month","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}}]}},{"when":{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"a","type":"Literal"},"then":{"type":"GreaterOrEqual","operand":[{"type":"ToDecimal","operand":{"precision":"Year","type":"CalculateAgeAt","operand":[{"type":"ToDateTime","operand":{"path":"birthDate.value","type":"Property","source":{"name":"Patient","type":"ExpressionRef"}}},{"name":"ToDateTime","libraryName":"FHIRHelpers","type":"FunctionRef","operand":[{"strict":false,"type":"As","operand":{"path":"occurrence","type":"Property","source":{"name":"immunization","type":"OperandRef"}},"asTypeSpecifier":{"name":"{http://hl7.org/fhir}dateTime","type":"NamedTypeSpecifier"}}]}]}},{"path":"value","type":"Property","source":{"path":"absMinAge","type":"Property","source":{"name":"age","type":"OperandRef"}}}]}}],"else":{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"type":"Null"}}}},"operand":[{"name":"age","operandTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"IsValidSeriesDose","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"And","operand":[{"type":"And","operand":[{"name":"IsValidAllowableVaccine","type":"FunctionRef","operand":[{"path":"allowableVaccine","type":"Property","source":{"name":"seriesDose","type":"OperandRef"}},{"name":"immunization","type":"OperandRef"}]},{"name":"IsValidAllowableInterval","type":"FunctionRef","operand":[{"path":"allowableInterval","type":"Property","source":{"name":"seriesDose","type":"OperandRef"}},{"name":"immunization","type":"OperandRef"},{"name":"previousImmunization","type":"OperandRef"}]}]},{"name":"IsValidAllowableAge","type":"FunctionRef","operand":[{"path":"age","type":"Property","source":{"name":"seriesDose","type":"OperandRef"}},{"name":"immunization","type":"OperandRef"}]}]},"operand":[{"name":"seriesDose","operandTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"immunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}},{"name":"previousImmunization","operandTypeSpecifier":{"name":"{http://hl7.org/fhir}Immunization","type":"NamedTypeSpecifier"}}]},{"name":"EvaluateSeriesDose","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"If","condition":{"type":"Or","operand":[{"type":"GreaterOrEqual","operand":[{"name":"currentImmunizationIndex","type":"OperandRef"},{"type":"Count","source":{"name":"Immunizations","type":"ExpressionRef"}}]},{"type":"IsNull","operand":{"name":"previousValidDoseIndex","type":"OperandRef"}}]},"then":{"type":"Tuple","element":[{"name":"doseNumber","value":{"path":"doseNumber","type":"Property","source":{"name":"seriesDose","type":"OperandRef"}}},{"name":"doseIndex","value":{"name":"currentDoseIndex","type":"OperandRef"}},{"name":"immunizationIndex","value":{"type":"Null"}},{"name":"immunization","value":{"type":"Null"}},{"name":"validDose","value":{"type":"Null"}}]},"else":{"type":"Tuple","element":[{"name":"doseNumber","value":{"path":"doseNumber","type":"Property","source":{"name":"seriesDose","type":"OperandRef"}}},{"name":"doseIndex","value":{"name":"currentDoseIndex","type":"OperandRef"}},{"name":"immunizationIndex","value":{"name":"currentImmunizationIndex","type":"OperandRef"}},{"name":"immunization","value":{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"OperandRef"}]}},{"name":"validDose","value":{"name":"IsValidSeriesDose","type":"FunctionRef","operand":[{"name":"seriesDose","type":"OperandRef"},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"currentImmunizationIndex","type":"OperandRef"}]},{"type":"Indexer","operand":[{"name":"Immunizations","type":"ExpressionRef"},{"name":"previousValidImmunizationIndex","type":"OperandRef"}]}]}}]}},"operand":[{"name":"seriesDose","operandTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"currentDoseIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"currentImmunizationIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"previousValidDoseIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"previousValidImmunizationIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}}]},{"name":"EvaluateSeriesDoses","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Query","source":[{"alias":"seriesDose","expression":{"name":"seriesDoses","type":"OperandRef"}}],"relationship":[],"aggregate":{"identifier":"R","distinct":false,"expression":{"type":"Union","operand":[{"type":"As","operand":{"name":"R","type":"QueryLetRef"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}},{"type":"As","operand":{"type":"List","element":[{"type":"Query","source":[{"alias":"X","expression":{"name":"seriesDose","type":"AliasRef"}}],"let":[{"identifier":"currentImmunizationIndex","expression":{"type":"If","condition":{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},"then":{"type":"Add","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"name":"startingImmunizationIndex","type":"OperandRef"}]},"else":{"name":"startingImmunizationIndex","type":"OperandRef"}}},{"identifier":"previousValidDoseIndex","expression":{"type":"If","condition":{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},"then":{"path":"doseIndex","type":"Property","source":{"type":"Last","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}},"else":{"type":"Negate","operand":{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"1","type":"Literal"}}}},{"identifier":"previousValidImmunizationIndex","expression":{"type":"If","condition":{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},"then":{"path":"immunizationIndex","type":"Property","source":{"type":"Last","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"R","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}},"else":{"type":"Negate","operand":{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"1","type":"Literal"}}}},{"identifier":"currentDoseIndex","expression":{"type":"If","condition":{"type":"Greater","operand":[{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}]},"then":{"type":"Count","source":{"name":"R","type":"QueryLetRef"}},"else":{"valueType":"{urn:hl7-org:elm-types:r1}Integer","value":"0","type":"Literal"}}}],"relationship":[],"return":{"expression":{"name":"EvaluateSeriesDose","type":"FunctionRef","operand":[{"name":"seriesDose","type":"AliasRef"},{"name":"currentDoseIndex","type":"QueryLetRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"},{"name":"previousValidDoseIndex","type":"QueryLetRef"},{"name":"previousValidImmunizationIndex","type":"QueryLetRef"}]}}}]},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}}]},"starting":{"strict":false,"type":"As","operand":{"type":"List"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}}},"operand":[{"name":"seriesDoses","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"startingImmunizationIndex","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}}]},{"name":"IsValidPrimarySeries","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"GreaterOrEqual","operand":[{"type":"Count","source":{"type":"Query","source":[{"alias":"$this","expression":{"name":"doseEvaluations","type":"OperandRef"}}],"where":{"type":"Equal","operand":[{"path":"validDose","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}},{"path":"primarySeriesNumberDoses","type":"Property","source":{"type":"First","source":{"type":"Query","source":[{"alias":"$this","expression":{"path":"series","type":"Property","source":{"name":"AntigenAncillaryData","type":"ParameterRef"}}}],"where":{"type":"Equal","operand":[{"path":"seriesName","scope":"$this","type":"Property"},{"name":"primarySeriesName","type":"OperandRef"}]}}}}]},"operand":[{"name":"primarySeriesName","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"seriesDoses","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"doseEvaluations","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}]},{"name":"EvaluateSeriesImmunizations","context":"Patient","accessLevel":"Public","type":"FunctionDef","expression":{"type":"Query","source":[{"alias":"immunization","expression":{"name":"Immunizations","type":"ExpressionRef"}}],"relationship":[],"aggregate":{"identifier":"R","distinct":false,"expression":{"type":"Union","operand":[{"type":"As","operand":{"name":"R","type":"QueryLetRef"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validPrimarySeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}},{"name":"doses","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}},{"name":"allDoses","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}}]}]}}},{"type":"As","operand":{"type":"List","element":[{"type":"Query","source":[{"alias":"X","expression":{"name":"immunization","type":"AliasRef"}}],"let":[{"identifier":"currentImmunizationIndex","expression":{"type":"Count","source":{"name":"R","type":"QueryLetRef"}}},{"identifier":"doseEvaluations","expression":{"name":"EvaluateSeriesDoses","type":"FunctionRef","operand":[{"name":"seriesDoses","type":"OperandRef"},{"name":"currentImmunizationIndex","type":"QueryLetRef"}]}}],"relationship":[],"return":{"expression":{"type":"Tuple","element":[{"name":"startingImmunizationIndex","value":{"name":"currentImmunizationIndex","type":"QueryLetRef"}},{"name":"validPrimarySeries","value":{"name":"IsValidPrimarySeries","type":"FunctionRef","operand":[{"name":"seriesName","type":"OperandRef"},{"name":"seriesDoses","type":"OperandRef"},{"type":"Query","source":[{"alias":"X","expression":{"name":"doseEvaluations","type":"QueryLetRef"}}],"return":{"distinct":false,"expression":{"type":"As","operand":{"name":"X","type":"AliasRef"},"asTypeSpecifier":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}}]}},{"name":"doses","value":{"type":"Query","source":[{"alias":"$this","expression":{"name":"doseEvaluations","type":"QueryLetRef"}}],"where":{"type":"Equal","operand":[{"asType":"{urn:hl7-org:elm-types:r1}Boolean","type":"As","operand":{"path":"validDose","scope":"$this","type":"Property"}},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}},{"name":"allDoses","value":{"name":"doseEvaluations","type":"QueryLetRef"}}]}}}]},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validPrimarySeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}},{"name":"doses","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}},{"name":"allDoses","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"ChoiceTypeSpecifier","choice":[{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"immunization","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Any","type":"NamedTypeSpecifier"}}]},{"type":"TupleTypeSpecifier","element":[{"name":"immunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"validDose","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}]}}}]}]}}}]},"starting":{"strict":false,"type":"As","operand":{"type":"List"},"asTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"startingImmunizationIndex","elementType":{"name":"{urn:hl7-org:elm-types:r1}Integer","type":"NamedTypeSpecifier"}},{"name":"validSeries","elementType":{"name":"{urn:hl7-org:elm-types:r1}Boolean","type":"NamedTypeSpecifier"}}]}}}}},"operand":[{"name":"seriesName","operandTypeSpecifier":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"seriesDoses","operandTypeSpecifier":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"doseNumber","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"age","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"absMinAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}},{"name":"earliestRecAge","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}},{"name":"interval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"earliestRecInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableInterval","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"fromPrevious","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}},{"name":"absMinInt","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"value","elementType":{"name":"{urn:hl7-org:elm-types:r1}Decimal","type":"NamedTypeSpecifier"}},{"name":"unit","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}},{"name":"allowableVaccine","elementType":{"type":"ListTypeSpecifier","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"cvx","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}},{"name":"conditionalSkip","elementType":{"type":"TupleTypeSpecifier","element":[{"name":"context","elementType":{"name":"{urn:hl7-org:elm-types:r1}String","type":"NamedTypeSpecifier"}}]}}]}}}]},{"name":"EvaluateSeries","context":"Patient","accessLevel":"Public","expression":{"type":"Query","source":[{"alias":"series","expression":{"path":"series","type":"Property","source":{"name":"AntigenSupportingData","type":"ParameterRef"}}}],"relationship":[],"where":{"type":"Not","operand":{"type":"Equal","operand":[{"path":"seriesType","scope":"series","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}String","value":"Risk","type":"Literal"}]}},"return":{"expression":{"type":"Tuple","element":[{"name":"seriesName","value":{"path":"seriesName","scope":"series","type":"Property"}},{"name":"complete","value":{"type":"Query","source":[{"alias":"$this","expression":{"name":"EvaluateSeriesImmunizations","type":"FunctionRef","operand":[{"path":"seriesName","scope":"series","type":"Property"},{"path":"seriesDose","scope":"series","type":"Property"}]}}],"where":{"type":"Equal","operand":[{"path":"validPrimarySeries","scope":"$this","type":"Property"},{"valueType":"{urn:hl7-org:elm-types:r1}Boolean","value":"true","type":"Literal"}]}}}]}}}},{"name":"Run","context":"Patient","accessLevel":"Public","expression":{"name":"EvaluateSeries","type":"ExpressionRef"}}]}}}