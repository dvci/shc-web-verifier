(this["webpackJsonpshc-web-verifier"]=this["webpackJsonpshc-web-verifier"]||[]).push([[0],{107:function(e,t){},238:function(e,t,n){},239:function(e,t,n){},267:function(e,t){},269:function(e,t){},410:function(e,t){},446:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(220),i=n.n(c),s=(n(238),n(24)),o=(n(239),n(229)),d=n(221),u=n.n(d),l=n(222),h=n(19),j=n.n(h),f=n(38),p=n(461),m=n(464),b=n(467),x=n(465),g=n(466),O=n(82),v=n(77),y=n.n(v),E=n.p+"static/media/iisstandards_tradename.ca620fff.xml",w=n.p+"static/media/iisstandards_cvx.f9c3cb7c.xml",C=n(2),N=Object(p.a)({bold:{fontWeight:"bold"}}),B=function(e){var t=e.patientData,n=N(),c=Object(r.useState)({}),i=Object(s.a)(c,2),o=i[0],d=i[1],u=Object(r.useState)({}),l=Object(s.a)(u,2),h=l[0],p=l[1];function v(e){return B.apply(this,arguments)}function B(){return(B=Object(f.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.get(t,{Accept:"application/xml"});case 2:return n=e.sent,e.next=5,n.data;case 5:if(r=(r=e.sent).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),a=new DOMParser,!((c=a.parseFromString(r,"application/xml")).getElementsByTagName("parsererror").length>0)){e.next=11;break}throw new Error("Error parsing XML");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a.a.useEffect((function(){function e(){return(e=Object(f.a)(j.a.mark((function e(){var t,n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(E);case 2:for(t=e.sent,n=t.evaluate("//productnames/prodInfo",t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=n.iterateNext(),a={};r;)a[r.children[5].textContent.trim()]?a[r.children[5].textContent.trim()]=r.children[3].textContent:a[r.children[5].textContent.trim()]=r.children[1].textContent,r=n.iterateNext();d(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(f.a)(j.a.mark((function e(){var t,n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(w);case 2:for(t=e.sent,n=t.evaluate("//CVXCodes/CVXInfo",t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=n.iterateNext(),a={};r;)a[r.getElementsByTagName("CVXCode")[0].textContent.trim()]=r.getElementsByTagName("ShortDescription")[0].textContent,r=n.iterateNext();p(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}()}),[]);var I=function(e){if(0===e.length)return"";var t=e[0];return o[t.code]?o[t.code]:h[t.code]?h[t.code]:t.system?"".concat(t.system,"#").concat(t.code):t.code};return Object(C.jsxs)("div",{children:[Object(C.jsxs)(O.a,{gutterBottom:!0,children:[Object(C.jsx)("span",{className:n.bold,children:"Name: "}),Object(C.jsx)("span",{children:t.name})]}),Object(C.jsxs)(O.a,{gutterBottom:!0,children:[Object(C.jsx)("span",{className:n.bold,children:"Date of Birth: "}),Object(C.jsx)("span",{children:t.dateOfBirth})]}),Object(C.jsx)(O.a,{variant:"h4",children:" Immunizations "}),Object(C.jsx)(m.a,{container:!0,spacing:2,direction:"row",justifyContent:"flex-start",alignItems:"flex-start",children:t.immunizations.map((function(e){return function(e){var t=e.fullUrl,r=e.resource;return Object(C.jsx)(m.a,{item:!0,children:Object(C.jsxs)(b.a,{variant:"outlined",children:[Object(C.jsx)(x.a,{title:r.vaccineCode?I(r.vaccineCode.coding):"",classes:{title:n.bold}}),Object(C.jsxs)(g.a,{children:[Object(C.jsxs)(O.a,{gutterBottom:!0,children:[Object(C.jsx)("span",{className:n.bold,children:"Date: "}),Object(C.jsx)("span",{children:r.occurrenceDateTime})]}),r.lotNumber&&Object(C.jsxs)(O.a,{gutterBottom:!0,children:[Object(C.jsx)("span",{className:n.bold,children:"Lot: "}),Object(C.jsx)("span",{children:r.lotNumber})]}),r.performer&&r.performer.length>0&&Object(C.jsxs)(O.a,{gutterBottom:!0,children:[Object(C.jsx)("span",{className:n.bold,children:"Performer: "}),Object(C.jsx)("span",{children:r.performer[0].actor.display})]})]})]})},t)}(e)}))})]})},I=n(228),S=n.n(I),T=n(124),D=n.n(T),k=Object(p.a)({bold:{fontWeight:"bold"}}),A=function(e){var t=e.jws,n=e.iss,c=k(),i=Object(r.useState)(),o=Object(s.a)(i,2),d=o[0],u=o[1],l=Object(r.useState)(null),h=Object(s.a)(l,2),p=h[0],m=h[1];return a.a.useEffect((function(){var e=new S.a.Agent({rejectUnauthorized:!1});function r(){return(r=Object(f.a)(j.a.mark((function r(){var a,c,i,s,o;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n&&"string"===typeof n){r.next=2;break}throw Error("Invalid issuer.");case 2:return r.prev=2,i="".concat(n,"/.well-known/jwks.json"),r.next=6,y.a.get(i,{httpsAgent:e});case 6:a=r.sent,r.next=12;break;case 9:throw r.prev=9,r.t0=r.catch(2),Error("Error retrieving issuer key URL.");case 12:return r.prev=12,r.next=15,a.data;case 15:return s=r.sent,r.next=18,D.a.JWK.asKeyStore(s).then((function(e){return e}));case 18:o=r.sent,c=D.a.JWS.createVerify(o),r.next=25;break;case 22:throw r.prev=22,r.t1=r.catch(12),Error("Error processing issuer keys.");case 25:return r.prev=25,r.next=28,c.verify(t).then((function(){return!0})).catch((function(){return!1}));case 28:return r.abrupt("return",r.sent);case 31:throw r.prev=31,r.t2=r.catch(25),Error("Error validating signature.");case 34:case"end":return r.stop()}}),r,null,[[2,9],[12,22],[25,31]])})))).apply(this,arguments)}(function(){return r.apply(this,arguments)})().then((function(e){u(e),m(null)})).catch((function(e){m(e.message),u(null)}))}),[t,n]),Object(C.jsxs)("div",{className:"HealthCardVerify",children:[Object(C.jsxs)(O.a,{children:[Object(C.jsx)("span",{className:c.bold,children:"Verified: "}),Object(C.jsx)("span",{children:String(d)})]}),Object(C.jsx)("div",{id:"errorMessage",children:Object(C.jsxs)(O.a,{children:[Object(C.jsx)("span",{className:c.bold,children:"Error: "}),Object(C.jsx)("span",{children:p})]})})]})};var R=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(null),i=Object(s.a)(c,2),d=i[0],h=i[1],j=function(e){var t=e.lastIndexOf("/");return e.slice(t+1).match(/\d\d/g).map((function(e){return String.fromCharCode(+e+45)})).join("")},f=function(e){var t=j(e).split(".")[1],n=o.a.toUint8Array(t),r=l.a.inflateRaw(n);return(new TextDecoder).decode(r)},p=function(){var e=document.getElementById("video");e.srcObject.getTracks().forEach((function(e){return e.stop()})),e.remove(),document.getElementById("canvas").hidden=!0,document.getElementById("loadingMessage").hidden=!0,a(!1)};function m(){var e=document.getElementById("video");if(e){if(e.readyState===e.HAVE_ENOUGH_DATA){var t=document.getElementById("canvas"),n=t.getContext("2d"),r=document.getElementById("loadingMessage"),a=document.getElementById("statusMessage");r.hidden=!0,t.hidden=!1,t.height=e.videoHeight,t.width=e.videoWidth,n.drawImage(e,0,0,t.width,t.height);var c=n.getImageData(0,0,t.width,t.height),i=u()(c.data,c.width,c.height,{inversionAttempts:"dontInvert"});i?i.data.startsWith("shc:/")?(p(),h(i.data)):a.innerText="QR code does not contain a SMART Health Card":a.innerText="No QR code detected"}requestAnimationFrame(m)}}var b=Object(C.jsx)("button",{type:"button",id:"start",onClick:function(){a(!0),h(null);var e=document.createElement("video"),t=document.getElementById("loadingMessage");e.id="video",e.hidden=!0,document.children[0].appendChild(e),t.hidden=!1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(t){e.srcObject=t,e.setAttribute("playsinline",!0),e.play().catch((function(){})),requestAnimationFrame(m)}))},disabled:n,children:"Scan"}),x=Object(C.jsx)("button",{type:"button",id:"stop",onClick:p,disabled:!n,children:"Stop"});return Object(C.jsxs)("div",{className:"App",children:[Object(C.jsx)("header",{className:"App-header",children:Object(C.jsx)("h1",{children:"SMART Health Cards Web Verifier"})}),Object(C.jsxs)("div",{children:[b,x]}),Object(C.jsx)("div",{id:"loadingMessage",hidden:!0,children:"Loading..."}),Object(C.jsx)("canvas",{id:"canvas",hidden:!n}),Object(C.jsx)("div",{id:"statusMessage",hidden:!n,children:"No QR code detected."}),d&&!n?Object(C.jsx)(B,{patientData:d?function(e){var t=JSON.parse(e).vc.credentialSubject.fhirBundle,n=t.entry.find((function(e){return"Patient"===e.resource.resourceType})).resource;return{name:function(e){var t=e.name[0];return t.text?t.text:[t.prefix?t.prefix.join(" "):"",t.given?t.given.join(" "):"",t.family?t.family:"",t.suffix?t.suffix.join(" "):""].join(" ").trim()}(n),dateOfBirth:n.birthDate,immunizations:function(e){return e.entry.filter((function(e){return"Immunization"===e.resource.resourceType}))}(t)}}(f(d)):null}):"",d&&!n?Object(C.jsx)(A,{jws:j(d),iss:d?JSON.parse(f(d)).iss:null}):""]})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,469)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(C.jsx)(a.a.StrictMode,{children:Object(C.jsx)(R,{})}),document.getElementById("root")),M()}},[[446,1,2]]]);
//# sourceMappingURL=main.4fa953cd.chunk.js.map