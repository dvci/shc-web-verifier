(this["webpackJsonpshc-web-verifier"]=this["webpackJsonpshc-web-verifier"]||[]).push([[0],{108:function(e,t){},240:function(e,t,n){},241:function(e,t,n){},269:function(e,t){},271:function(e,t){},412:function(e,t){},448:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),c=n(223),i=n.n(c),s=(n(240),n(13)),o=(n(241),n(233)),u=n(224),d=n.n(u),l=n(225),h=n(8),j=n.n(h),f=n(21),p=n(463),b=n(466),m=n(469),x=n(467),O=n(468),v=n(83),g=n(39),y=n.n(g),E=n.p+"static/media/iisstandards_tradename.ca620fff.xml",w=n.p+"static/media/iisstandards_cvx.f9c3cb7c.xml",N=n(1),C=Object(p.a)({bold:{fontWeight:"bold"}}),I=function(e){var t=e.patientData,n=C(),c=Object(r.useState)({}),i=Object(s.a)(c,2),o=i[0],u=i[1],d=Object(r.useState)({}),l=Object(s.a)(d,2),h=l[0],p=l[1];function g(e){return I.apply(this,arguments)}function I(){return(I=Object(f.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.get(t,{Accept:"application/xml"});case 2:return n=e.sent,e.next=5,n.data;case 5:if(r=(r=e.sent).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),a=new DOMParser,!((c=a.parseFromString(r,"application/xml")).getElementsByTagName("parsererror").length>0)){e.next=11;break}throw new Error("Error parsing XML");case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a.a.useEffect((function(){function e(){return(e=Object(f.a)(j.a.mark((function e(){var t,n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(E);case 2:for(t=e.sent,n=t.evaluate("//productnames/prodInfo",t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=n.iterateNext(),a={};r;)a[r.children[5].textContent.trim()]?a[r.children[5].textContent.trim()]=r.children[3].textContent:a[r.children[5].textContent.trim()]=r.children[1].textContent,r=n.iterateNext();u(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(f.a)(j.a.mark((function e(){var t,n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(w);case 2:for(t=e.sent,n=t.evaluate("//CVXCodes/CVXInfo",t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=n.iterateNext(),a={};r;)a[r.getElementsByTagName("CVXCode")[0].textContent.trim()]=r.getElementsByTagName("ShortDescription")[0].textContent,r=n.iterateNext();p(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}()}),[]);var S=function(e){if(0===e.length)return"";var t=e[0];return o[t.code]?o[t.code]:h[t.code]?h[t.code]:t.system?"".concat(t.system,"#").concat(t.code):t.code};return Object(N.jsxs)("div",{children:[Object(N.jsxs)(v.a,{gutterBottom:!0,children:[Object(N.jsx)("span",{className:n.bold,children:"Name: "}),Object(N.jsx)("span",{children:t.name})]}),Object(N.jsxs)(v.a,{gutterBottom:!0,children:[Object(N.jsx)("span",{className:n.bold,children:"Date of Birth: "}),Object(N.jsx)("span",{children:t.dateOfBirth})]}),Object(N.jsx)(v.a,{variant:"h4",children:" Immunizations "}),Object(N.jsx)(b.a,{container:!0,spacing:2,direction:"row",justifyContent:"flex-start",alignItems:"flex-start",children:t.immunizations.map((function(e){return function(e){var t=e.fullUrl,r=e.resource;return Object(N.jsx)(b.a,{item:!0,children:Object(N.jsxs)(m.a,{variant:"outlined",children:[Object(N.jsx)(x.a,{title:r.vaccineCode?S(r.vaccineCode.coding):"",classes:{title:n.bold}}),Object(N.jsxs)(O.a,{children:[Object(N.jsxs)(v.a,{gutterBottom:!0,children:[Object(N.jsx)("span",{className:n.bold,children:"Date: "}),Object(N.jsx)("span",{children:r.occurrenceDateTime})]}),r.lotNumber&&Object(N.jsxs)(v.a,{gutterBottom:!0,children:[Object(N.jsx)("span",{className:n.bold,children:"Lot: "}),Object(N.jsx)("span",{children:r.lotNumber})]}),r.performer&&r.performer.length>0&&Object(N.jsxs)(v.a,{gutterBottom:!0,children:[Object(N.jsx)("span",{className:n.bold,children:"Performer: "}),Object(N.jsx)("span",{children:r.performer[0].actor.display})]})]})]})},t)}(e)}))})]})},S=n(80),k=n.n(S),D=n(125),B=n.n(D),T=Object(p.a)({bold:{fontWeight:"bold"}}),A=function(e){var t=e.jws,n=e.iss,c=T(),i=Object(r.useState)(),o=Object(s.a)(i,2),u=o[0],d=o[1],l=Object(r.useState)(null),h=Object(s.a)(l,2),p=h[0],b=h[1];return a.a.useEffect((function(){var e=new k.a.Agent({rejectUnauthorized:!1});function r(){return(r=Object(f.a)(j.a.mark((function r(){var a,c,i,s,o;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n&&"string"===typeof n){r.next=2;break}throw Error("Invalid issuer.");case 2:return r.prev=2,i="".concat(n,"/.well-known/jwks.json"),r.next=6,y.a.get(i,{httpsAgent:e});case 6:a=r.sent,r.next=12;break;case 9:throw r.prev=9,r.t0=r.catch(2),Error("Error retrieving issuer key URL.");case 12:return r.prev=12,r.next=15,a.data;case 15:return s=r.sent,r.next=18,B.a.JWK.asKeyStore(s).then((function(e){return e}));case 18:o=r.sent,c=B.a.JWS.createVerify(o),r.next=25;break;case 22:throw r.prev=22,r.t1=r.catch(12),Error("Error processing issuer keys.");case 25:return r.prev=25,r.next=28,c.verify(t).then((function(){return!0})).catch((function(){return!1}));case 28:return r.abrupt("return",r.sent);case 31:throw r.prev=31,r.t2=r.catch(25),Error("Error validating signature.");case 34:case"end":return r.stop()}}),r,null,[[2,9],[12,22],[25,31]])})))).apply(this,arguments)}(function(){return r.apply(this,arguments)})().then((function(e){d(e),b(null)})).catch((function(e){b(e.message),d(null)}))}),[t,n]),Object(N.jsxs)("div",{className:"HealthCardVerify",children:[Object(N.jsxs)(v.a,{children:[Object(N.jsx)("span",{className:c.bold,children:"Verified: "}),Object(N.jsx)("span",{children:String(u)})]}),Object(N.jsx)("div",{id:"errorMessage",children:Object(N.jsxs)(v.a,{children:[Object(N.jsx)("span",{className:c.bold,children:"Error: "}),Object(N.jsx)("span",{children:p})]})})]})},R=Object(p.a)({bold:{fontWeight:"bold"}}),M=function(e){var t=e.iss,n=e.issuerDirectories,a=R(),c=Object(r.useState)(null),i=Object(s.a)(c,2),o=i[0],u=i[1],d=Object(r.useState)(null),l=Object(s.a)(d,2),h=l[0],j=l[1];return Object(r.useEffect)((function(){if(n){var e=n.map((function(e){return e.error?"".concat(e.name,": ").concat(e.error):null}));j(e);var r=n.some((function(e){var n;if(e.issuers&&!e.error&&(null===(n=e.issuers)||void 0===n?void 0:n.participating_issuers.filter((function(e){return e.iss===t})).map((function(e){return e.name}))[0]))return!0;return!1}));u(r)}}),[t,n]),Object(N.jsxs)("div",{className:"HealthCardVerify",children:[Object(N.jsxs)(v.a,{children:[Object(N.jsx)("span",{className:a.bold,children:"Issuer Verified: "}),Object(N.jsx)("span",{children:String(o)})]}),Object(N.jsx)("div",{id:"errorMessage",children:Object(N.jsxs)(v.a,{children:[Object(N.jsx)("span",{className:a.bold,children:"Error: "}),Object(N.jsx)("span",{children:h})]})})]})},_=n(231),V=n(232),P=[{name:"VCI",URL:"https://raw.githubusercontent.com/the-commons-project/vci-directory/main/vci-issuers.json"}],U=new k.a.Agent({rejectUnauthorized:!1}),F=function(){var e=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(P.map(function(){var e=Object(f.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.prev=1,e.next=4,y.a.get(t.URL,{httpsAgent:U});case 4:a=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),r.error="Error fetching issuer directory.",e.abrupt("return",r);case 11:if(r.issuers=a.data,null===(n=r.issuers)||void 0===n?void 0:n.participating_issuers){e.next=15;break}return r.error="Incorrect issuer directory format.",e.abrupt("return",r);case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){function e(){Object(_.a)(this,e)}return Object(V.a)(e,null,[{key:"getIssuerDirectories",value:function(){var e=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();var W=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(null),i=Object(s.a)(c,2),u=i[0],h=i[1],j=Object(r.useState)(null),f=Object(s.a)(j,2),p=f[0],b=f[1];Object(r.useEffect)((function(){L.getIssuerDirectories().then((function(e){b(e)})).catch((function(){b(null)}))}),[]);var m=function(e){var t=e.lastIndexOf("/");return e.slice(t+1).match(/\d\d/g).map((function(e){return String.fromCharCode(+e+45)})).join("")},x=function(e){var t=m(e).split(".")[1],n=o.a.toUint8Array(t),r=l.a.inflateRaw(n);return(new TextDecoder).decode(r)},O=function(){var e=document.getElementById("video");e.srcObject.getTracks().forEach((function(e){return e.stop()})),e.remove(),document.getElementById("canvas").hidden=!0,document.getElementById("loadingMessage").hidden=!0,a(!1)};function v(){var e=document.getElementById("video");if(e){if(e.readyState===e.HAVE_ENOUGH_DATA){var t=document.getElementById("canvas"),n=t.getContext("2d"),r=document.getElementById("loadingMessage"),a=document.getElementById("statusMessage");r.hidden=!0,t.hidden=!1,t.height=e.videoHeight,t.width=e.videoWidth,n.drawImage(e,0,0,t.width,t.height);var c=n.getImageData(0,0,t.width,t.height),i=d()(c.data,c.width,c.height,{inversionAttempts:"dontInvert"});i?i.data.startsWith("shc:/")?(O(),h(i.data)):a.innerText="QR code does not contain a SMART Health Card":a.innerText="No QR code detected"}requestAnimationFrame(v)}}var g=Object(N.jsx)("button",{type:"button",id:"start",onClick:function(){a(!0),h(null);var e=document.createElement("video"),t=document.getElementById("loadingMessage");e.id="video",e.hidden=!0,document.children[0].appendChild(e),t.hidden=!1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(t){e.srcObject=t,e.setAttribute("playsinline",!0),e.play().catch((function(){})),requestAnimationFrame(v)}))},disabled:n,children:"Scan"}),y=Object(N.jsx)("button",{type:"button",id:"stop",onClick:O,disabled:!n,children:"Stop"}),E=function(){return u?JSON.parse(x(u)).iss:null};return Object(N.jsxs)("div",{className:"App",children:[Object(N.jsx)("header",{className:"App-header",children:Object(N.jsx)("h1",{children:"SMART Health Cards Web Verifier"})}),Object(N.jsxs)("div",{children:[g,y]}),Object(N.jsx)("div",{id:"loadingMessage",hidden:!0,children:"Loading..."}),Object(N.jsx)("canvas",{id:"canvas",hidden:!n}),Object(N.jsx)("div",{id:"statusMessage",hidden:!n,children:"No QR code detected."}),u&&!n?Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(I,{patientData:u?function(e){var t=JSON.parse(e).vc.credentialSubject.fhirBundle,n=t.entry.find((function(e){return"Patient"===e.resource.resourceType})).resource;return{name:function(e){var t=e.name[0];return t.text?t.text:[t.prefix?t.prefix.join(" "):"",t.given?t.given.join(" "):"",t.family?t.family:"",t.suffix?t.suffix.join(" "):""].join(" ").trim()}(n),dateOfBirth:n.birthDate,immunizations:function(e){return e.entry.filter((function(e){return"Immunization"===e.resource.resourceType}))}(t)}}(x(u)):null}),Object(N.jsx)(A,{jws:m(u),iss:E()}),Object(N.jsx)(M,{iss:E(),issuerDirectories:p})]}):""]})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,471)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(N.jsx)(a.a.StrictMode,{children:Object(N.jsx)(W,{})}),document.getElementById("root")),H()}},[[448,1,2]]]);
//# sourceMappingURL=main.e4c7cf77.chunk.js.map