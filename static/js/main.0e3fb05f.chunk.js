(this["webpackJsonpshc-web-verifier"]=this["webpackJsonpshc-web-verifier"]||[]).push([[0],{47:function(e,t,n){},48:function(e,t,n){},73:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(30),c=n.n(i),s=(n(47),n(12)),d=(n(48),n(40)),o=n(31),l=n.n(o),u=n(32),h=n(20),m=n.n(h),j=n(33),f=n(90),b=n(93),p=n(96),g=n(94),x=n(95),O=n(18),v=n(34),y=n.n(v),E=n.p+"static/media/iisstandards_tradename.7e848362.xml",B=n(2),C=Object(f.a)({bold:{fontWeight:"bold"}}),I=function(e){var t=e.patientData,n=C(),i=Object(r.useState)({}),c=Object(s.a)(i,2),d=c[0],o=c[1];a.a.useEffect((function(){function e(){return(e=Object(j.a)(m.a.mark((function e(){var t,n,r,a,i,c,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.get(E,{Accept:"application/xml"});case 2:return t=e.sent,e.next=5,t.data;case 5:if(n=(n=e.sent).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),r=new DOMParser,!((a=r.parseFromString(n,"application/xml")).getElementsByTagName("parsererror").length>0)){e.next=11;break}throw new Error("Error parsing XML");case 11:for(i=a.evaluate("//productnames/prodInfo",a,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),c=i.iterateNext(),s={};c;)s[c.children[5].textContent.trim()]?s[c.children[5].textContent.trim()]=c.children[3].textContent:s[c.children[5].textContent.trim()]=c.children[1].textContent,c=i.iterateNext();o(s);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var l=function(e){if(0===e.length)return"";var t=e[0];return d[t.code]?d[t.code]:t.system?"".concat(t.system,"#").concat(t.code):t.code};return Object(B.jsxs)("div",{children:[Object(B.jsxs)(O.a,{gutterBottom:!0,children:[Object(B.jsx)("span",{className:n.bold,children:"Name: "}),Object(B.jsx)("span",{children:t.name})]}),Object(B.jsxs)(O.a,{gutterBottom:!0,children:[Object(B.jsx)("span",{className:n.bold,children:"Date of Birth: "}),Object(B.jsx)("span",{children:t.dateOfBirth})]}),Object(B.jsx)(O.a,{variant:"h4",children:" Immunizations "}),Object(B.jsx)(b.a,{container:!0,spacing:2,direction:"row",justifyContent:"flex-start",alignItems:"flex-start",children:t.immunizations.map((function(e){return function(e){var t=e.fullUrl,r=e.resource;return Object(B.jsx)(b.a,{item:!0,children:Object(B.jsxs)(p.a,{variant:"outlined",children:[Object(B.jsx)(g.a,{title:r.vaccineCode?l(r.vaccineCode.coding):"",classes:{title:n.bold}}),Object(B.jsxs)(x.a,{children:[Object(B.jsxs)(O.a,{gutterBottom:!0,children:[Object(B.jsx)("span",{className:n.bold,children:"Date: "}),Object(B.jsx)("span",{children:r.occurrenceDateTime})]}),r.lotNumber&&Object(B.jsxs)(O.a,{gutterBottom:!0,children:[Object(B.jsx)("span",{className:n.bold,children:"Lot: "}),Object(B.jsx)("span",{children:r.lotNumber})]}),r.performer&&r.performer.length>0&&Object(B.jsxs)(O.a,{gutterBottom:!0,children:[Object(B.jsx)("span",{className:n.bold,children:"Performer: "}),Object(B.jsx)("span",{children:r.performer[0].actor.display})]})]})]})},t)}(e)}))})]})};var N=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(null),c=Object(s.a)(i,2),o=c[0],h=c[1],m=function(){var e=document.getElementById("video");e.srcObject.getTracks().forEach((function(e){return e.stop()})),e.remove(),document.getElementById("canvas").hidden=!0,document.getElementById("loadingMessage").hidden=!0,a(!1)};function j(){var e=document.getElementById("video");if(e){if(e.readyState===e.HAVE_ENOUGH_DATA){var t=document.getElementById("canvas"),n=t.getContext("2d"),r=document.getElementById("loadingMessage"),a=document.getElementById("statusMessage");r.hidden=!0,t.hidden=!1,t.height=e.videoHeight,t.width=e.videoWidth,n.drawImage(e,0,0,t.width,t.height);var i=n.getImageData(0,0,t.width,t.height),c=l()(i.data,i.width,i.height,{inversionAttempts:"dontInvert"});if(c)if(c.data.startsWith("shc:/")){m();var s=function(e){var t=JSON.parse(e).vc.credentialSubject.fhirBundle,n=t.entry.find((function(e){return"Patient"===e.resource.resourceType})).resource;return{name:function(e){var t=e.name[0];return t.text?t.text:[t.prefix?t.prefix.join(" "):"",t.given?t.given.join(" "):"",t.family?t.family:"",t.suffix?t.suffix.join(" "):""].join(" ").trim()}(n),dateOfBirth:n.birthDate,immunizations:function(e){return e.entry.filter((function(e){return"Immunization"===e.resource.resourceType}))}(t)}}(function(e){var t=e.lastIndexOf("/"),n=e.slice(t+1).match(/\d\d/g).map((function(e){return String.fromCharCode(+e+45)})).join("").split(".")[1],r=d.a.toUint8Array(n),a=u.a.inflateRaw(r);return(new TextDecoder).decode(a)}(c.data));h(s)}else a.innerText="QR code does not contain a SMART Health Card";else a.innerText="No QR code detected"}requestAnimationFrame(j)}}var f=Object(B.jsx)("button",{type:"button",id:"start",onClick:function(){a(!0),h(null);var e=document.createElement("video"),t=document.getElementById("loadingMessage");e.id="video",e.hidden=!0,document.children[0].appendChild(e),t.hidden=!1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(t){e.srcObject=t,e.setAttribute("playsinline",!0),e.play().catch((function(){})),requestAnimationFrame(j)}))},disabled:n,children:"Scan"}),b=Object(B.jsx)("button",{type:"button",id:"stop",onClick:m,disabled:!n,children:"Stop"});return Object(B.jsxs)("div",{className:"App",children:[Object(B.jsx)("header",{className:"App-header",children:Object(B.jsx)("h1",{children:"SMART Health Cards Web Verifier"})}),Object(B.jsxs)("div",{children:[f,b]}),Object(B.jsx)("div",{id:"loadingMessage",hidden:!0,children:"Loading..."}),Object(B.jsx)("canvas",{id:"canvas",hidden:!n}),Object(B.jsx)("div",{id:"statusMessage",hidden:!n,children:"No QR code detected."}),o&&!n?Object(B.jsx)(I,{patientData:o}):""]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,98)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))};c.a.render(Object(B.jsx)(a.a.StrictMode,{children:Object(B.jsx)(N,{})}),document.getElementById("root")),w()}},[[73,1,2]]]);
//# sourceMappingURL=main.0e3fb05f.chunk.js.map