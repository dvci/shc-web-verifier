{"version":3,"sources":["components/HealthCardDisplay/iisstandards_tradename.xml","components/HealthCardDisplay/iisstandards_cvx.xml","components/HealthCardDisplay/HealthCardDisplay.js","components/HealthCardVerify/HealthCardVerify.js","components/IssuerVerify/IssuerVerify.js","components/IssuerVerify/IssuerDirectories.js","components/App/App.js","reportWebVitals.js","index.js"],"names":["useStyles","makeStyles","bold","fontWeight","HealthCardDisplay","patientData","classes","useState","tradenames","setTradenames","cvxCodes","setCvxCodes","fetchCdcXml","file","a","axios","get","Accept","response","data","replace","parser","DOMParser","xmlDoc","parseFromString","getElementsByTagName","length","Error","React","useEffect","tradenamesXml","prodInfos","evaluate","XPathResult","ORDERED_NODE_ITERATOR_TYPE","prodInfo","iterateNext","tn","children","textContent","trim","cvxXml","cvx","fetchTradenames","fetchCvx","immunizationDisplayName","codings","coding","code","system","Typography","gutterBottom","className","name","dateOfBirth","variant","Grid","container","spacing","direction","justifyContent","alignItems","immunizations","map","i","immunization","fullUrl","resource","item","Card","CardHeader","title","vaccineCode","CardContent","occurrenceDateTime","lotNumber","performer","actor","display","immunizationDisplay","HealthCardVerify","jws","iss","verified","setVerified","error","setError","agent","https","Agent","rejectUnauthorized","jwkURL","httpsAgent","keySet","jose","JWK","asKeyStore","then","result","keyStore","verifier","JWS","createVerify","verify","catch","status","err","message","String","id","IssuerVerify","issuerDirectories","errors","setErrors","errorMessages","d","found","some","issuers","participating_issuers","filter","issuer","defaultIssuerDirectories","URL","getIssuerDirectories","Promise","all","directory","IssuerDirectories","App","isScanning","setIsScanning","qrCode","setQrCode","setIssuerDirectories","fetchedDirectories","getJws","qrString","sliceIndex","lastIndexOf","slice","match","charPair","fromCharCode","join","getPayload","dataString","split","decodedPayload","Base64","toUint8Array","inflatedPayload","pako","inflateRaw","TextDecoder","decode","stopScanning","video","document","getElementById","srcObject","getTracks","forEach","track","stop","remove","hidden","tick","readyState","HAVE_ENOUGH_DATA","canvasElement","canvas","getContext","loadingMessage","statusMessage","height","videoHeight","width","videoWidth","drawImage","imageData","getImageData","jsQR","inversionAttempts","startsWith","innerText","requestAnimationFrame","startButton","type","onClick","createElement","appendChild","navigator","mediaDevices","getUserMedia","facingMode","stream","setAttribute","play","disabled","stopButton","getIssuer","JSON","parse","card","bundle","vc","credentialSubject","fhirBundle","patient","entry","find","resourceType","nameElement","text","prefix","given","family","suffix","extractPatientName","birthDate","extractImmunizations","extractPatientData","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.e4c7cf77.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/iisstandards_tradename.ca620fff.xml\";","export default __webpack_public_path__ + \"static/media/iisstandards_cvx.f9c3cb7c.xml\";","import React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n  Card, CardContent, CardHeader, Grid, Typography\n} from '@material-ui/core';\nimport axios from 'axios';\nimport tradenamesXml from './iisstandards_tradename.xml';\nimport cvxXml from './iisstandards_cvx.xml';\n\nconst useStyles = makeStyles({\n  bold: {\n    fontWeight: 'bold'\n  }\n});\n\nconst HealthCardDisplay = ({ patientData }) => {\n  const classes = useStyles();\n\n  const [tradenames, setTradenames] = useState({});\n  const [cvxCodes, setCvxCodes] = useState({});\n\n  async function fetchCdcXml(file) {\n    const response = await axios.get(file, {\n      Accept: 'application/xml'\n    });\n    let data = await response.data;\n    data = data.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;');\n    const parser = new DOMParser();\n    const xmlDoc = parser.parseFromString(data, 'application/xml');\n    if (xmlDoc.getElementsByTagName('parsererror').length > 0) {\n      throw new Error('Error parsing XML');\n    }\n    return xmlDoc;\n  }\n\n  React.useEffect(() => {\n    async function fetchTradenames() {\n      const xmlDoc = await fetchCdcXml(tradenamesXml);\n      const prodInfos = xmlDoc.evaluate('//productnames/prodInfo',\n        xmlDoc, null, XPathResult.ORDERED_NODE_ITERATOR_TYPE, null);\n      let prodInfo = prodInfos.iterateNext();\n      const tn = {};\n      while (prodInfo) {\n        if (tn[prodInfo.children[5].textContent.trim()]) {\n          tn[prodInfo.children[5].textContent.trim()] = prodInfo.children[3].textContent\n        } else {\n          tn[prodInfo.children[5].textContent.trim()] = prodInfo.children[1].textContent\n        }\n        prodInfo = prodInfos.iterateNext();\n      }\n      setTradenames(tn);\n    }\n\n    async function fetchCvx() {\n      const xmlDoc = await fetchCdcXml(cvxXml);\n      const prodInfos = xmlDoc.evaluate('//CVXCodes/CVXInfo',\n        xmlDoc, null, XPathResult.ORDERED_NODE_ITERATOR_TYPE, null);\n      let prodInfo = prodInfos.iterateNext();\n      const cvx = {};\n      while (prodInfo) {\n        cvx[prodInfo.getElementsByTagName('CVXCode')[0].textContent.trim()] = prodInfo.getElementsByTagName('ShortDescription')[0].textContent\n        prodInfo = prodInfos.iterateNext();\n      }\n      setCvxCodes(cvx);\n    }\n\n    fetchTradenames();\n    fetchCvx();\n  }, []);\n\n  const immunizationDisplayName = (codings) => {\n    if (codings.length === 0) return '';\n\n    const coding = codings[0];\n\n    if (!tradenames[coding.code]) {\n      if (!cvxCodes[coding.code]) {\n        return coding.system ? `${coding.system}#${coding.code}` : coding.code;\n      }\n      return cvxCodes[coding.code];\n    }\n    return tradenames[coding.code];\n  };\n\n  const immunizationDisplay = (immunization) => {\n    const { fullUrl, resource } = immunization;\n\n    return (\n      <Grid item key={fullUrl}>\n        <Card variant=\"outlined\">\n          <CardHeader\n            title={\n              resource.vaccineCode ? immunizationDisplayName(resource.vaccineCode.coding) : ''\n            }\n            classes={{ title: classes.bold }}\n          />\n          <CardContent>\n            <Typography gutterBottom>\n              <span className={classes.bold}>Date: </span>\n              <span>{resource.occurrenceDateTime}</span>\n            </Typography>\n            {resource.lotNumber && (\n              <Typography gutterBottom>\n                <span className={classes.bold}>Lot: </span>\n                <span>{resource.lotNumber}</span>\n              </Typography>\n            )}\n            {(resource.performer && resource.performer.length > 0) && (\n              <Typography gutterBottom>\n                <span className={classes.bold}>Performer: </span>\n                <span>{resource.performer[0].actor.display}</span>\n              </Typography>\n            )}\n          </CardContent>\n        </Card>\n      </Grid>\n    );\n  }\n\n  return (\n    <div>\n      <Typography gutterBottom>\n        <span className={classes.bold}>Name: </span>\n        <span>{patientData.name}</span>\n      </Typography>\n      <Typography gutterBottom>\n        <span className={classes.bold}>Date of Birth: </span>\n        <span>{patientData.dateOfBirth}</span>\n      </Typography>\n      <Typography variant=\"h4\"> Immunizations </Typography>\n      <Grid\n        container\n        spacing={2}\n        direction=\"row\"\n        justifyContent=\"flex-start\"\n        alignItems=\"flex-start\"\n      >\n        {patientData.immunizations.map((i) => immunizationDisplay(i))}\n      </Grid>\n    </div>\n  );\n};\n\nexport default HealthCardDisplay;\n","import React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport axios from 'axios';\nimport https from 'https';\nimport jose from 'node-jose';\nimport {\n  Typography\n} from '@material-ui/core';\n\nconst useStyles = makeStyles({\n  bold: {\n    fontWeight: 'bold'\n  }\n});\n\nconst HealthCardVerify = ({ jws, iss }) => {\n  const classes = useStyles();\n\n  const [verified, setVerified] = useState();\n  const [error, setError] = useState(null);\n\n  React.useEffect(() => {\n    const agent = new https.Agent({\n      rejectUnauthorized: false\n    });\n\n    async function verify() {\n      let response;\n      let verifier;\n\n      if (!iss || typeof iss !== 'string') {\n        throw Error('Invalid issuer.');\n      }\n\n      try {\n        const jwkURL = `${iss}/.well-known/jwks.json`;\n        response = await axios.get(jwkURL, { httpsAgent: agent });\n      } catch (err) { // network error, incorrect URL or status!=2xx\n        throw Error('Error retrieving issuer key URL.');\n      }\n\n      try {\n        const keySet = await response.data;\n        const keyStore = await jose.JWK.asKeyStore(keySet)\n          .then((result) => result);\n        verifier = jose.JWS.createVerify(keyStore);\n      } catch (err) { // key format error\n        throw Error('Error processing issuer keys.');\n      }\n\n      try {\n        return await verifier.verify(jws)\n          .then(() => true)\n          .catch(() => false);\n      } catch (err) {\n        throw Error('Error validating signature.');\n      }\n    }\n\n    verify()\n      .then((status) => {\n        setVerified(status);\n        setError(null);\n      })\n      .catch((err) => {\n        setError(err.message);\n        setVerified(null);\n      });\n  }, [jws, iss]);\n\n  return (\n    <div className=\"HealthCardVerify\">\n      <Typography>\n        <span className={classes.bold}>Verified: </span>\n        <span>{String(verified)}</span>\n      </Typography>\n      <div id=\"errorMessage\">\n        <Typography>\n          <span className={classes.bold}>Error: </span>\n          <span>{error}</span>\n        </Typography>\n      </div>\n    </div>\n  );\n};\n\nexport default HealthCardVerify;\n","import React, { useState, useEffect } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n  Typography\n} from '@material-ui/core';\n\nconst useStyles = makeStyles({\n  bold: {\n    fontWeight: 'bold'\n  }\n});\n\nconst IssuerVerify = ({ iss, issuerDirectories }) => {\n  const classes = useStyles();\n\n  const [verified, setVerified] = useState(null);\n  const [errors, setErrors] = useState(null);\n\n  useEffect(() => {\n    if (!issuerDirectories) {\n      return;\n    }\n\n    const errorMessages = issuerDirectories.map((d) => {\n      if (d.error) {\n        return `${d.name}: ${d.error}`;\n      }\n      return null;\n    });\n    setErrors(errorMessages);\n\n    const found = issuerDirectories.some((d) => {\n      if (d.issuers && !d.error) {\n        const issName = d.issuers?.participating_issuers\n          .filter((issuer) => issuer.iss === iss)\n          .map((issuer) => issuer.name)[0];\n        if (issName) {\n          return true;\n        }\n      }\n      return false;\n    });\n    setVerified(found);\n  }, [iss, issuerDirectories]);\n\n  return (\n    <div className=\"HealthCardVerify\">\n      <Typography>\n        <span className={classes.bold}>Issuer Verified: </span>\n        <span>{String(verified)}</span>\n      </Typography>\n      <div id=\"errorMessage\">\n        <Typography>\n          <span className={classes.bold}>Error: </span>\n          <span>{errors}</span>\n        </Typography>\n      </div>\n    </div>\n  );\n};\n\nexport default IssuerVerify;\n","import axios from 'axios';\nimport https from 'https';\n\nconst defaultIssuerDirectories = [\n  {\n    name: 'VCI',\n    URL: 'https://raw.githubusercontent.com/the-commons-project/vci-directory/main/vci-issuers.json'\n  }\n]\n\nconst agent = new https.Agent({\n  rejectUnauthorized: false\n});\n\nconst getIssuerDirectories = async () => Promise.all(defaultIssuerDirectories.map(async (d) => {\n  const directory = d;\n  let response;\n  try {\n    response = await axios.get(d.URL, { httpsAgent: agent });\n  } catch (err) {\n    directory.error = 'Error fetching issuer directory.';\n    return directory;\n  }\n\n  directory.issuers = response.data;\n  if (!directory.issuers?.participating_issuers) {\n    directory.error = 'Incorrect issuer directory format.';\n    return directory;\n  }\n  return directory;\n}));\n\nexport default class IssuerDirectories {\n  static async getIssuerDirectories() { return getIssuerDirectories(); }\n}\n","import './App.css';\n\nimport React, { useState, useEffect } from 'react';\nimport { Base64 } from 'js-base64';\nimport jsQR from 'jsqr';\nimport pako from 'pako';\nimport HealthCardDisplay from 'components/HealthCardDisplay';\nimport HealthCardVerify from 'components/HealthCardVerify';\nimport IssuerVerify, { IssuerDirectories } from 'components/IssuerVerify';\n\nfunction App() {\n  const [isScanning, setIsScanning] = useState(false);\n  const [qrCode, setQrCode] = useState(null);\n  const [issuerDirectories, setIssuerDirectories] = useState(null);\n\n  useEffect(() => {\n    IssuerDirectories.getIssuerDirectories()\n      .then((fetchedDirectories) => {\n        setIssuerDirectories(fetchedDirectories);\n      }).catch(() => {\n        setIssuerDirectories(null);\n      });\n  }, []);\n\n  const getJws = (qrString) => {\n    const sliceIndex = qrString.lastIndexOf('/');\n    const rawPayload = qrString.slice(sliceIndex + 1);\n    const encodingChars = rawPayload.match(/\\d\\d/g);\n    return encodingChars.map((charPair) => String.fromCharCode(+charPair + 45)).join('');\n  };\n\n  const getPayload = (qrString) => {\n    const jwsString = getJws(qrString)\n    const dataString = jwsString.split('.')[1];\n    const decodedPayload = Base64.toUint8Array(dataString);\n    const inflatedPayload = pako.inflateRaw(decodedPayload);\n    const payload = new TextDecoder().decode(inflatedPayload);\n    return payload;\n  };\n\n  const extractPatientName = (patient) => {\n    const nameElement = patient.name[0];\n\n    if (nameElement.text) {\n      return nameElement.text;\n    }\n\n    const prefix = nameElement.prefix ? nameElement.prefix.join(' ') : '';\n    const given = nameElement.given ? nameElement.given.join(' ') : '';\n    const family = nameElement.family ? nameElement.family : '';\n    const suffix = nameElement.suffix ? nameElement.suffix.join(' ') : '';\n\n    const name = [prefix, given, family, suffix].join(' ');\n\n    return name.trim();\n  };\n\n  const extractImmunizations = (bundle) => {\n    const immunizationResources = bundle.entry\n      .filter((entry) => entry.resource.resourceType === 'Immunization')\n\n    return immunizationResources;\n  };\n\n  const extractPatientData = (card) => {\n    const bundle = JSON.parse(card).vc.credentialSubject.fhirBundle;\n    const patient = bundle.entry.find(\n      (entry) => entry.resource.resourceType === 'Patient'\n    ).resource;\n\n    const name = extractPatientName(patient);\n    const dateOfBirth = patient.birthDate;\n    const immunizations = extractImmunizations(bundle);\n    return { name, dateOfBirth, immunizations };\n  };\n\n  const stopScanning = () => {\n    const video = document.getElementById('video');\n    video.srcObject.getTracks().forEach((track) => track.stop());\n    video.remove();\n    document.getElementById('canvas').hidden = true;\n    document.getElementById('loadingMessage').hidden = true;\n    setIsScanning(false);\n  };\n\n  function tick() {\n    const video = document.getElementById('video');\n    if (!video) {\n      return;\n    }\n\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n      const canvasElement = document.getElementById('canvas');\n      const canvas = canvasElement.getContext('2d');\n      const loadingMessage = document.getElementById('loadingMessage');\n      const statusMessage = document.getElementById('statusMessage');\n\n      loadingMessage.hidden = true;\n      canvasElement.hidden = false;\n\n      canvasElement.height = video.videoHeight;\n      canvasElement.width = video.videoWidth;\n      canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);\n      const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);\n      const code = jsQR(imageData.data, imageData.width, imageData.height, {\n        inversionAttempts: 'dontInvert'\n      });\n      if (code) {\n        if (code.data.startsWith('shc:/')) {\n          stopScanning();\n          setQrCode(code.data);\n        } else {\n          statusMessage.innerText = 'QR code does not contain a SMART Health Card';\n        }\n      } else {\n        statusMessage.innerText = 'No QR code detected';\n      }\n    }\n\n    requestAnimationFrame(tick);\n  }\n\n  const startScanning = () => {\n    setIsScanning(true);\n    setQrCode(null);\n\n    const video = document.createElement('video');\n    const loadingMessage = document.getElementById('loadingMessage');\n    video.id = 'video';\n    video.hidden = true;\n    document.children[0].appendChild(video);\n    loadingMessage.hidden = false;\n\n    navigator.mediaDevices\n      .getUserMedia({ video: { facingMode: 'environment' } })\n      .then((stream) => {\n        video.srcObject = stream;\n        video.setAttribute('playsinline', true); // required to tell iOS safari we don't want fullscreen\n        video.play().catch(() => {\n          /* ignore error since it's caused by us stopping the scan */\n        });\n        requestAnimationFrame(tick);\n      });\n  };\n\n  const startButton = (\n    <button type=\"button\" id=\"start\" onClick={startScanning} disabled={isScanning}>\n      Scan\n    </button>\n  );\n\n  const stopButton = (\n    <button type=\"button\" id=\"stop\" onClick={stopScanning} disabled={!isScanning}>\n      Stop\n    </button>\n  );\n\n  const patientData = () => {\n    if (!qrCode) { return null; }\n    const decodedQr = getPayload(qrCode);\n    return extractPatientData(decodedQr);\n  };\n\n  const getIssuer = () => {\n    if (!qrCode) { return null; }\n    const payload = JSON.parse(getPayload(qrCode));\n    return payload.iss;\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1>SMART Health Cards Web Verifier</h1>\n      </header>\n      <div>\n        {startButton}\n        {stopButton}\n      </div>\n      <div id=\"loadingMessage\" hidden>\n        Loading...\n      </div>\n      <canvas id=\"canvas\" hidden={!isScanning} />\n      <div id=\"statusMessage\" hidden={!isScanning}>\n        No QR code detected.\n      </div>\n      {qrCode && !isScanning ? (\n        <>\n          <HealthCardDisplay patientData={patientData()} />\n          <HealthCardVerify jws={getJws(qrCode)} iss={getIssuer()} />\n          <IssuerVerify iss={getIssuer()} issuerDirectories={issuerDirectories} />\n        </>\n      ) : ''}\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({\n      getCLS, getFID, getFCP, getLCP, getTTFB\n    }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from 'components/App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}